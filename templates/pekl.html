{% extends "base.html" %}
{% block body %}
    
    <h1 id="test">New Keyboard</h1><br>
    <pre><div id="remapped_text"></div></pre>
    <div class='newKeyboard'>
        {% for key in keyboard %}
            <div class="block" id="{{key[0]}}">
                {% for values in key %}
                    {% if loop.index == 2 %}
                        {% if values|length == 2%}
                            {% for value in values %}
                                {{value}} <br>
                            {% endfor %}
                        {% else %}
                            {{values}}
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
            {% if key[0]=="B14" %}
                <div class="block" id="C01">CAPS</div>
            {% elif key[0]=="C13"%}
                <div class="block" id="D01">SHIFT</div>
            {% elif key[0]=="D11"%}
                <div class="block" id="D12">SHIFT</div>
                <div class="block" id="E01">CONTROL</div>
                <div class="block" id="E02">SUPER</div>
                <div class="block" id="E03">ALT</div>
            {% elif key[0]=="E04" %}
                <div class="block" id="E05">ALT</div>
                <div class="block" id="E06">SUPER</div>
                <div class="block" id="E07">META</div>
                <div class="block" id="E08">CONTROL</div>
            {% endif %}
        {% endfor %}
    </div>

    <script>
    
    //PLACEMENT ANIMATION

    var randNumMin = 550;
    var randNumMax = 2100;

    $(document).ready(function() {
        $(function() {
            $('.block').each(function(i) {
                $(this).delay((Math.floor(Math.random() * (randNumMax - randNumMin + 1)) + randNumMin)).fadeTo(30, 1); })
        });
    });

    //KEYPRESS ANIMATIONS
    var keys = {192:"A01", 49:"A02", 50:"A03", 51:"A04", 52:"A05", 53:"A06", 54:"A07", 55:"A08", 56:"A09", 57:"A10", 48:"A11", 189:"A12", 187:"A13", 8:"A14", 
            9:"B01", 81:"B02", 87:"B03", 69:"B04", 82:"B05", 84:"B06", 89:"B07", 85:"B08", 73:"B09", 79:"B10", 80:"B11", 219:"B12", 221:"B13", 220:"B14", 
            20:"C01", 65:"C02", 83:"C03", 68:"C04", 70:"C05", 71:"C06", 72:'C07', 74:'C08', 75:'C09', 76:'C10',  186:"C11", 222:'C12', 13:"C13", 
            16:"D01", 90:"D02", 88:"D03", 67:"D04", 86:"D05", 66:"D06", 78:"D07", 77:'D08', 188:"D09", 190:"D10", 191:"D11", 
            17:"E01", 18:"E03", 32:"E04"}

    visual_value = {219:('[', '{'), 220:('\\', '|'), 221:(']', '}'), 192:('`','~'), 186:(';', ':'), 190:('.', '>'), 188:(',','>'), 189:('-','_'),
        222:("'",'"'), 187:('=','+'), 190:("/", '?'), 9:('TAB','TAB'), 3:('ENTER','ENTER'), 17:('CTRL','CTRL'), 16:('SHIFT','SHIFT'), 
        18:('ALT','ALT'), 32:('SPACE','SPACE'), 20:('CAPS','CAPS'), 8:('DELETE','DELETE'),
        48:('0', ')'), 49:('1', '!'), 50:('2','@'), 51:('3','#'), 52:('4','$'), 53:('5','%'), 54:('6','^'), 55:('7','&'), 56:('8','*'), 57:('9','('),
        65:('a', 'A'), 66:('b', 'B'), 67:('c', 'C'), 68:('d', 'D'), 69:('e', 'E'), 82:('r', 'R'), 83:('s', 'S'), 80:('p', 'P'), 81:('q', 'Q'), 87:('w', 'W'), 
        84:('t', 'T'), 85:('u', 'U'), 86:('v', 'V'), 76:('l', 'L'), 75:('k', 'K'), 74:('j', 'J'), 73:('i', 'I'), 72:('h', 'H'), 71:('g', 'G'), 70:('f', 'F'), 
        79:('o', 'O'), 78:('n', 'N'), 90:('z', 'Z'), 77:('m', 'M'), 88:('x', 'X'), 89:('y', 'Y')}


    //makes assumption that caps lock default state is off
    var caps_on = false;
    var shift_on = false;
    var prev_key = null;

    var keyboard = {{keyboard|tojson|safe}};
    var new_keys = {}

    //creates dictionary from passed in keyboard var for remapping process
    for (var i =0; i<keyboard.length;i++) {
        for (var h in keyboard[i]) {
            console.log(keyboard[0]);
            console.log(keyboard[0][1]);
            console.log(keyboard[0][1][1]);





            // if (h == 0) {
            //     new_keys[keyboard[i][h]] = [];    
            // } else {
            //     if (keyboard[i][1].length > 1) {
            //         new_keys[keyboard[i][0]].push(keyboard[i][1][1]);
            //         new_keys[keyboard[i][0]].push(keyboard[i][1][0]);
            //     } else {
            //         var value = keyboard[i][1][0];
            //         if (value != 'DELETE') {
            //             var alt_value = find_altValue(value, keyboard[i][0]);
            //             new_keys[keyboard[i][0]].push(alt_value); 
            //         }
            //         if ((value != 'SPACE') & (value != 'ENTER') & (value != 'TAB')) {
            //             new_keys[keyboard[i][0]].push(value);
            //         } 
            //     }
            // }
        // }
    }

    function keyDisplays(event) {
        //remaps key values
        var textarea = document.getElementById('remapped_text');
        var k = key_specific[event.which];

        //if shift, return shifted value
        if (event.which == 20) {
            if (caps_on) {
                document.getElementById('C01').style.backgroundColor="212121";
            } else {
                document.getElementById('C01').style.backgroundColor="orange"; 
            }
            caps_on = !caps_on;
        } else if (event.which == 16) {
            shift_on = true;
            document.getElementById('D01').style.backgroundColor="orange";
            document.getElementById('D12').style.backgroundColor="orange";
        } else {
            var key = document.getElementById(keys[event.which]);
            key.style.backgroundColor="orange";
            prev_key = key;
            if (possible_values[0] == 'DELETE') {
                textarea.innerHTML = textarea.innerHTML.slice(0, -1);
            } else if ((caps_on) || (shift_on)) {
                if (possible_values[1]) {
                    var chr = possible_values[1];
                } else {
                    var chr = possible_values[0];   
                }
                textarea.innerHTML += chr;
            } else {
                var chr = possible_values[0];
                textarea.innerHTML += chr;
            }
        }
    }

    
    $('body').keydown(function (event) {
            keyDisplays(event);
    });

    $('body').keyup(function (event) {
        if (event.which == 16) {
            shift_on = false;
            document.getElementById('D01').style.backgroundColor="212121";
            document.getElementById('D12').style.backgroundColor="212121";
        } else if (event.which != 20) {
            var key = document.getElementById(keys[event.which]);
            key.style.backgroundColor="212121";
        }
    });


    </script>
{% endblock %}